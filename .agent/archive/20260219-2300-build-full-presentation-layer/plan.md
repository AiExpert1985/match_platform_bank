# Plan: Build Full Presentation Layer (UI + State)

## Goal
Build the complete presentation layer: single-screen RTL/Arabic UI wired to Riverpod 3 state, surfacing reconciliation results in a single unified 7-column table.

## Scope Boundaries
✓ In scope: pubspec updates, main.dart rewrite, AppNotifier, MainScreen, ImportButton widget, ResultsSection widget
✗ Out of scope: import error surfacing, navigation, persistence, export, tests

---

## Relevant Contracts

- **Stateless / In-memory** — Provider state exists only during the session; no data is written to disk.
- **Input Contract** — Two Excel (.xlsx) files only; validation is handled inside ExcelImportService, not the UI.
- **Safety** — UI is read-only; no record editing, deleting, or adding allowed.
- **Matching Types** — Full match, partial match, unmatched bank, unmatched platform are all produced by the engine. The UI table displays only partial match, unmatched bank, and unmatched platform (full matches intentionally excluded from display).

---

## Relevant Design Constraints

- **RTL / Arabic** — `Directionality(RTL)` applied globally via MaterialApp locale; all labels in Arabic.
- **Single-screen architecture** — Three vertical sections: Import (top), Action (middle), Result (bottom).
- **Riverpod 3 (Generator syntax)** — All providers use `@riverpod` annotation; `build_runner` generates `.g.dart` files.
- **Simple, clean table layout** — No decorative theming; functional and readable tables.
- **Feature-first structure** — All new files live under `lib/features/transactions/presentation/`.
- **Single responsibility** — Each widget/class has one reason to change (~20–30 lines target).

---

## Execution Strategy

1. **Verify & add dependencies**: Look up latest stable versions of `flutter_riverpod`, `riverpod_annotation`, `riverpod_generator`, `build_runner`, and `file_picker`; update `pubspec.yaml`.
2. **Define state model**: Create sealed `ImportState` and `ReconciliationState` classes, then `AppNotifier` (`@riverpod` class) that holds both import states and reconciliation state, exposes `importFile(source)` and `reconcile()` methods.
3. **Rewrite main.dart**: Wrap app in `ProviderScope`, set `locale: Locale('ar')` and `Directionality(RTL)`, route to `MainScreen`.
4. **Build ImportButton widget**: Stateless widget accepting `TransactionSource`; reads import state from provider; shows a button that triggers `importFile()` and displays success/failure status below.
5. **Build MainScreen**: Three-zone `Column` with `SafeArea`; Import zone has the two `ImportButton` widgets; Action zone has the generate button (watches both import states for enabled state); Result zone is a scrollable `ResultsSection`.
6. **Build ResultsTable widget**: Reads `ReconciliationReport` from provider; merges partial match + unmatched bank + unmatched platform results into a single sorted list (order: partial → unmatched bank → unmatched platform); renders one `DataTable` with 7 columns — platform account, platform amount, platform date, bank account, bank amount, bank date, status. Unmatched bank rows leave platform columns empty; unmatched platform rows leave bank columns empty.
7. **Run build_runner**: Generate `.g.dart` provider file.

---

## Affected Files

- `pubspec.yaml` — Add flutter_riverpod, riverpod_annotation, riverpod_generator, build_runner, file_picker; no contract impact
- `lib/main.dart` — Rewrite: ProviderScope + RTL MaterialApp + route to MainScreen; no contract impact
- `lib/features/transactions/presentation/providers/app_state.dart` — New: sealed ImportState + ReconciliationState classes
- `lib/features/transactions/presentation/providers/app_notifier.dart` — New: @riverpod AppNotifier class managing all UI state; touches ExcelImportService + ReconciliationService
- `lib/features/transactions/presentation/providers/app_notifier.g.dart` — Generated by build_runner
- `lib/features/transactions/presentation/screens/main_screen.dart` — New: MainScreen widget with three-zone layout and SafeArea
- `lib/features/transactions/presentation/widgets/import_button.dart` — New: file-picker button with status indicator below
- `lib/features/transactions/presentation/widgets/results_table.dart` — New: single 7-column DataTable (platform cols | bank cols | status); excludes full matches; rows ordered by status
